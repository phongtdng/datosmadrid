---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  eval = FALSE
)
```

# datosmadrid

<!-- badges: start -->

<!-- badges: end -->

`datosmadrid` is an R package that makes it easier to access and work with the [Madrid Open Data Portal](https://datos.madrid.es/portal/site/egob).

It provides tools to: -

-   Search the **dataset catalogue** by keyword

-   Retrieve and parse **metadata**

-   **Download** and parse dataset resources (CSV, JSON, XML, XLS, …)

-   Summarize the portal (number of datasets, categories, licenses)

-   Explore and call the official **API endpoints**

This package is developed as part of a Master’s thesis project.

------------------------------------------------------------------------

## Installation

You can install the development version from GitHub:

```{r install}
# install.packages("remotes")

remotes::install_github("phongtdng/datosmadrid")
```

# Example Usage

## Explore the portal overview

```{r}
library(datosmadrid)

ov <- portal_overview(catalogue = "all")
ov$datasets
ov$api
```

## Search for datasets

```{r}
# Search catalogue
res <- search_datasets("bici", page_limit = 1, n_max = 10, enrich = TRUE)
res
```

## Get metadata and Download resources

```{r}
md <- get_metadata(res$link[1])
md$title
md$resources

# Download one resource
csv_url <- md$resources$url[md$resources$format == "CSV"][1]
data <- download_dataset(csv_url, parse = TRUE)
head(data)
```

## API Endpoints

```{r}
eps <- list_api_endpoints(filter = "bici", method = "get", include_params = TRUE)
head(eps[, c("path","method","title")])

out <- fetch_api(
  path = "/catalogo/201132-0-museos.{formato}",
  path_params = list(formato = "json"),
  parse = TRUE
)
```

# Documentation

See package vignettes for more examples

```{r}
browseVignettes("datosmadrid")
```

# Notes

-   Functions that access the portal require an internet connection.

-   Results may change as the portal content is updated.

-   Please respect the portal's terms of use.
